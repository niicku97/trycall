<html>

<body>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>

    <div id='peerid'>    </div>
    <input type='text' id='callings'></input>
    <button onclick='call()'>Call</button>
    <button onclick='answerer()'>Answer</button>
    <audio control></audio>

    <script>
var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

function onReceiveStream(stream) {
    var audio = document.querySelector('audio');
    console.log(audio);
    audio.srcObject = stream;
    audio.onloadedmetadata = function(e){
        console.log('now playing the audio');
        audio.play();
    }
}

function call() {
            var person_to_call = document.getElementById('callings').value;
            console.log(`WE IS CALLING BRO ${person_to_call}`)

            var peer = new Peer();

            getUserMedia({video: false , audio: true}, function(stream) {
            var call = peer.call(person_to_call, stream);
            call.on('stream', function(remoteStream) {
                onReceiveStream(remoteStream)
                // Show stream in some video/canvas element.
            });
            }, function(err) {
            console.log('Failed to get local stream' ,err);
            });

        }
function answerer() {
    var peer = new Peer();

    peer.on('open', (id) => {
        document.getElementById('peerid').innerHTML = id;
    })

    peer.on('call', function(call) {
        getUserMedia({video: false, audio: true} , function(stream) {
            console.log('WE IS GETIN CALLDD!')

            call.answer(stream);
            call.on('stream', function(remoteStream) {
                onReceiveStream(remoteStream)
                //show stream in some video/canvas elem
            });

        }, function (err){
            console.log('Failed to get local stream', err);
        });
    });

    
}
    </script>
</body>
</html>